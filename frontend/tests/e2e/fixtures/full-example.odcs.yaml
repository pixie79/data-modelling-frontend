# Full ODCS Example for Integration Testing
# Based on: https://github.com/bitol-io/open-data-contract-standard/blob/main/docs/examples/all/full-example.odcs.yaml
# Enhanced with custom fields used by the data modelling application (position, order, etc.)

# What's this data contract about?
domain: seller
dataProduct: my quantum
version: 1.1.0
status: active
id: 53581432-6c55-4ba2-a65f-72344a91553a

authoritativeDefinitions:
  - type: canonical
    url: https://github.com/bitol-io/open-data-contract-standard/blob/main/docs/examples/all/full-example.odcs.yaml
    description: Canonical URL to the latest version of the contract.

# Description section
description:
  purpose: Views built on top of the seller tables.
  limitations: Data based on seller perspective, no buyer information
  usage: Predict sales over time
  authoritativeDefinitions:
    - type: privacy-statement
      url: https://example.com/gdpr.pdf
tenant: ClimateQuantumInc

kind: DataContract
apiVersion: v3.1.0

# Infrastructure & servers
servers:
  - server: my-postgres
    type: postgres
    host: localhost
    port: 5432
    database: pypl-edw
    schema: pp_access_views

# Dataset, schema, and quality
schema:
  # Main transaction table with all ODCS column properties
  - id: tbl_obj
    name: tbl
    physicalName: tbl_1
    physicalType: table
    businessName: Core Payment Metrics
    description: Provides core payment metrics including transaction references and receiver information
    status: active
    authoritativeDefinitions:
      - url: https://catalog.data.gov/dataset/air-quality
        type: businessDefinition
      - url: https://youtu.be/jbY1BKFj9ec
        type: videoTutorial
    tags:
      - finance
      - payments
    dataGranularityDescription: Aggregation on columns txn_ref_dt, pmt_txn_id

    # Schema-level relationships (for composite keys)
    relationships:
      - type: foreignKey
        from:
          - tbl.rcvr_id
          - tbl.rcvr_cntry_code
        to:
          - receivers.id
          - receivers.country_code
        customProperties:
          - property: description
            value: 'Composite key linking to receivers table'
          - property: cardinality
            value: 'many-to-one'

    properties:
      # Date column with partitioning
      - id: txn_ref_dt_prop
        name: transaction_reference_date
        physicalName: txn_ref_dt
        primaryKey: false
        primaryKeyPosition: -1
        businessName: transaction reference date
        logicalType: date
        physicalType: date
        required: false
        unique: false
        description: Reference date for transaction
        partitioned: true
        partitionKeyPosition: 1
        clustered: false
        criticalDataElement: false
        tags: []
        classification: public
        transformSourceObjects:
          - table_name_1
          - table_name_2
          - table_name_3
        transformLogic: sel t1.txn_dt as txn_ref_dt from table_name_1 as t1, table_name_2 as t2, table_name_3 as t3 where t1.txn_dt=date-3
        transformDescription: defines the logic in business terms; logic for dummies
        examples:
          - '2022-10-03'
          - '2020-01-28'
        customProperties:
          - property: anonymizationStrategy
            value: none
        # Custom field: column order for UI positioning
        custom:
          order: 0

      # Primary key column with relationship
      - id: rcvr_id_prop
        name: rcvr_id
        primaryKey: true
        primaryKeyPosition: 1
        businessName: receiver id
        logicalType: string
        physicalType: varchar(18)
        required: true
        unique: true
        description: A description for column rcvr_id.
        partitioned: false
        partitionKeyPosition: -1
        clustered: false
        criticalDataElement: true
        tags:
          - uid
        classification: restricted
        # Property-level relationship
        relationships:
          - to: receivers.id
            type: foreignKey
            customProperties:
              - property: description
                value: 'Links to receiver master data'
        custom:
          order: 1
          is_foreign_key: true

      # Country code column with authoritative definitions
      - id: rcvr_cntry_code_prop
        name: rcvr_cntry_code
        primaryKey: false
        primaryKeyPosition: -1
        businessName: receiver country code
        logicalType: string
        physicalType: varchar(2)
        required: false
        unique: false
        description: Country code of the receiver in ISO 3166-1 alpha-2 format
        partitioned: false
        partitionKeyPosition: -1
        clustered: true
        criticalDataElement: false
        tags: []
        classification: public
        authoritativeDefinitions:
          - url: https://collibra.com/asset/742b358f-71a5-4ab1-bda4-dcdba9418c25
            type: businessDefinition
          - url: https://github.com/myorg/myrepo
            type: transformationImplementation
          - url: jdbc:postgresql://localhost:5432/adventureworks/tbl_1/rcvr_cntry_code
            type: implementation
        encryptedName: rcvr_cntry_code_encrypted
        quality:
          - metric: nullValues
            mustBe: 0
            description: column should not contain null values
            dimension: completeness
            type: library
            severity: error
            businessImpact: operational
            schedule: 0 20 * * *
            scheduler: cron
            customProperties:
              - property: FIELD_NAME
                value:
              - property: COMPARE_TO
                value:
              - property: COMPARISON_TYPE
                value: Greater than
        custom:
          order: 2

      # Amount column with numeric constraints
      - id: txn_amount_prop
        name: txn_amount
        primaryKey: false
        primaryKeyPosition: -1
        businessName: transaction amount
        logicalType: decimal
        physicalType: decimal(18,2)
        required: true
        unique: false
        description: The total amount of the transaction in the transaction currency
        partitioned: false
        partitionKeyPosition: -1
        clustered: false
        criticalDataElement: true
        tags:
          - amount
          - financial
        classification: confidential
        logicalTypeOptions:
          minimum: 0
          maximum: 999999999.99
          precision: 18
          scale: 2
        default: '0.00'
        custom:
          order: 3

    # Table-level quality rules
    quality:
      - metric: rowCount
        mustBeGreaterThan: 1000000
        type: library
        description: Ensure row count is within expected volume range
        dimension: completeness
        method: reconciliation
        severity: error
        businessImpact: operational
        schedule: 0 20 * * *
        scheduler: cron

    # Table-level custom properties
    customProperties:
      - property: business-key
        value:
          - txn_ref_dt
          - rcvr_id

  # Receivers master table
  - id: receivers_obj
    name: receivers
    physicalName: receivers_master
    physicalType: table
    businessName: Receivers Master Data
    description: Master data for all receivers with composite primary key
    status: active
    tags:
      - master-data
      - receivers

    properties:
      # Composite primary key - first column
      - id: receiver_id_prop
        name: id
        primaryKey: true
        primaryKeyPosition: 1
        businessName: receiver identifier
        logicalType: string
        physicalType: varchar(18)
        required: true
        unique: true
        description: Unique identifier for receiver (part of composite PK)
        classification: restricted
        custom:
          order: 0

      # Composite primary key - second column
      - id: country_code_prop
        name: country_code
        primaryKey: true
        primaryKeyPosition: 2
        businessName: receiver country
        logicalType: string
        physicalType: varchar(2)
        required: true
        unique: false
        description: Country code of the receiver (part of composite PK)
        classification: public
        logicalTypeOptions:
          minLength: 2
          maxLength: 2
          pattern: '^[A-Z]{2}$'
        custom:
          order: 1

      # Regular columns
      - id: receiver_name_prop
        name: receiver_name
        businessName: receiver name
        logicalType: string
        physicalType: varchar(255)
        required: true
        unique: false
        description: Full legal name of the receiver
        classification: restricted
        criticalDataElement: true
        logicalTypeOptions:
          minLength: 1
          maxLength: 255
        custom:
          order: 2

      - id: receiver_type_prop
        name: receiver_type
        businessName: receiver type
        logicalType: string
        physicalType: varchar(20)
        required: false
        unique: false
        description: Type of receiver (individual, business, etc.)
        classification: public
        quality:
          - metric: validValues
            mustBeIn:
              - individual
              - business
              - government
              - non-profit
            description: Receiver type must be one of the allowed values
            dimension: validity
            type: library
            severity: warning
        # Relationship to lookup table
        relationships:
          - to: receiver_types.type_code
            customProperties:
              - property: description
                value: 'Links to receiver type definitions'
        custom:
          order: 3

      - id: receiver_email_prop
        name: email
        businessName: receiver email
        logicalType: string
        physicalType: varchar(255)
        required: false
        unique: true
        description: Primary email address for the receiver
        classification: pii
        criticalDataElement: true
        encryptedName: email_encrypted
        logicalTypeOptions:
          format: email
          maxLength: 255
        custom:
          order: 4

      - id: created_at_prop
        name: created_at
        businessName: creation timestamp
        logicalType: timestamp
        physicalType: timestamp with time zone
        required: true
        unique: false
        description: Timestamp when the receiver record was created
        classification: internal
        default: CURRENT_TIMESTAMP
        custom:
          order: 5

  # Receiver types lookup table
  - id: receiver_types_obj
    name: receiver_types
    physicalName: lkp_receiver_types
    physicalType: table
    businessName: Receiver Type Lookup
    description: Lookup table for valid receiver types
    status: active
    tags:
      - lookup
      - reference-data

    properties:
      - id: type_code_prop
        name: type_code
        primaryKey: true
        primaryKeyPosition: 1
        businessName: type code
        logicalType: string
        physicalType: varchar(20)
        required: true
        unique: true
        description: Unique code for the receiver type
        classification: public
        custom:
          order: 0

      - id: type_name_prop
        name: type_name
        businessName: type name
        logicalType: string
        physicalType: varchar(100)
        required: true
        unique: false
        description: Human-readable name for the receiver type
        classification: public
        custom:
          order: 1

      - id: type_description_prop
        name: type_description
        businessName: type description
        logicalType: string
        physicalType: text
        required: false
        unique: false
        description: Detailed description of the receiver type
        classification: public
        custom:
          order: 2

# Pricing
price:
  priceAmount: 9.95
  priceCurrency: USD
  priceUnit: megabyte

# Team
team:
  name: my-team
  description: The team owning the data contract
  members:
    - username: ceastwood
      role: Data Scientist
      dateIn: '2022-08-02'
      dateOut: '2022-10-01'
      replacedByUsername: mhopper
    - username: mhopper
      role: Data Scientist
      dateIn: '2022-10-01'
    - username: daustin
      role: Owner
      description: Keeper of the grail
      dateIn: '2022-10-01'

# Roles
roles:
  - role: microstrategy_user_opr
    access: read
    firstLevelApprovers: Reporting Manager
    secondLevelApprovers: mandolorian
  - role: bq_queryman_user_opr
    access: read
    firstLevelApprovers: Reporting Manager
    secondLevelApprovers: na
  - role: risk_data_access_opr
    access: read
    firstLevelApprovers: Reporting Manager
    secondLevelApprovers: dathvador
  - role: bq_unica_user_opr
    access: write
    firstLevelApprovers: Reporting Manager
    secondLevelApprovers: mickey

# SLA Properties
slaProperties:
  - property: latency
    value: 4
    unit: d
    element: tab1.txn_ref_dt
  - property: generalAvailability
    value: '2022-05-12T09:30:10-08:00'
  - property: endOfSupport
    value: '2032-05-12T09:30:10-08:00'
  - property: endOfLife
    value: '2042-05-12T09:30:10-08:00'
  - property: retention
    value: 3
    unit: y
    element: tab1.txn_ref_dt
  - property: frequency
    value: 1
    valueExt: 1
    unit: d
    element: tab1.txn_ref_dt
  - property: timeOfAvailability
    value: 09:00-08:00
    element: tab1.txn_ref_dt
    driver: regulatory
  - property: timeOfAvailability
    value: 08:00-08:00
    element: tab1.txn_ref_dt
    driver: analytics

# Support
support:
  - channel: '#product-help'
    tool: slack
  - channel: datacontract-ann
    tool: email
    url: mailto:datacontract-ann@bitol.io
  - channel: Feedback
    description: General Product Feedback (Public)
    url: https://product-feedback.com
  - channel: product-issues
    tool: teams
    scope: issues
    customProperties:
      - property: servicehours
        value: 9-5 CET

# Tags
tags:
  - transactions

# Custom properties
customProperties:
  - property: refRulesetName
    value: gcsc.ruleset.name
  - property: somePropertyName
    value: property.value
  - property: dataprocClusterName
    value: cluster name

contractCreatedTs: '2022-11-15T02:59:43+00:00'
