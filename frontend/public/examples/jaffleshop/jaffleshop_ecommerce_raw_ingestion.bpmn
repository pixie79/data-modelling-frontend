<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  id="Definitions_RawIngestion"
                  targetNamespace="http://jaffleshop.example/bpmn">

  <bpmn:process id="js-process-raw-ingestion" name="Raw Data Ingestion" isExecutable="true">
    <bpmn:documentation>
      Bronze Layer ETL Process - Ingests raw data from source systems into DuckDB.
      Extracts data from operational databases, validates schema, and loads into raw tables.
      Runs daily at 02:00 UTC.
    </bpmn:documentation>

    <!-- Start Event -->
    <bpmn:startEvent id="StartEvent_1" name="Daily Schedule Trigger">
      <bpmn:outgoing>Flow_1</bpmn:outgoing>
    </bpmn:startEvent>

    <!-- Extract Tasks (Parallel) -->
    <bpmn:parallelGateway id="Gateway_Split" name="Extract Sources in Parallel">
      <bpmn:incoming>Flow_1</bpmn:incoming>
      <bpmn:outgoing>Flow_2</bpmn:outgoing>
      <bpmn:outgoing>Flow_3</bpmn:outgoing>
      <bpmn:outgoing>Flow_4</bpmn:outgoing>
    </bpmn:parallelGateway>

    <bpmn:serviceTask id="Task_ExtractCustomers" name="Extract Customers">
      <bpmn:documentation>Extract customer data from CRM system</bpmn:documentation>
      <bpmn:incoming>Flow_2</bpmn:incoming>
      <bpmn:outgoing>Flow_5</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:serviceTask id="Task_ExtractOrders" name="Extract Orders &amp; Items">
      <bpmn:documentation>Extract orders and line items from POS system</bpmn:documentation>
      <bpmn:incoming>Flow_3</bpmn:incoming>
      <bpmn:outgoing>Flow_6</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:serviceTask id="Task_ExtractProducts" name="Extract Products &amp; Supplies">
      <bpmn:documentation>Extract product catalog and supply chain data</bpmn:documentation>
      <bpmn:incoming>Flow_4</bpmn:incoming>
      <bpmn:outgoing>Flow_7</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- Join parallel extracts -->
    <bpmn:parallelGateway id="Gateway_Join" name="Wait for All Extracts">
      <bpmn:incoming>Flow_5</bpmn:incoming>
      <bpmn:incoming>Flow_6</bpmn:incoming>
      <bpmn:incoming>Flow_7</bpmn:incoming>
      <bpmn:outgoing>Flow_8</bpmn:outgoing>
    </bpmn:parallelGateway>

    <!-- Validation -->
    <bpmn:serviceTask id="Task_ValidateSchema" name="Validate Schema">
      <bpmn:documentation>Validate extracted data against expected schemas</bpmn:documentation>
      <bpmn:incoming>Flow_8</bpmn:incoming>
      <bpmn:outgoing>Flow_9</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- Load to DuckDB -->
    <bpmn:serviceTask id="Task_LoadRaw" name="Load to Raw Tables">
      <bpmn:documentation>
        Load validated data into DuckDB raw schema:
        - raw.customers
        - raw.orders
        - raw.items
        - raw.products
        - raw.supplies
        - raw.stores
      </bpmn:documentation>
      <bpmn:incoming>Flow_9</bpmn:incoming>
      <bpmn:outgoing>Flow_10</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- End Event -->
    <bpmn:endEvent id="EndEvent_1" name="Ingestion Complete">
      <bpmn:incoming>Flow_10</bpmn:incoming>
    </bpmn:endEvent>

    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Gateway_Split"/>
    <bpmn:sequenceFlow id="Flow_2" sourceRef="Gateway_Split" targetRef="Task_ExtractCustomers"/>
    <bpmn:sequenceFlow id="Flow_3" sourceRef="Gateway_Split" targetRef="Task_ExtractOrders"/>
    <bpmn:sequenceFlow id="Flow_4" sourceRef="Gateway_Split" targetRef="Task_ExtractProducts"/>
    <bpmn:sequenceFlow id="Flow_5" sourceRef="Task_ExtractCustomers" targetRef="Gateway_Join"/>
    <bpmn:sequenceFlow id="Flow_6" sourceRef="Task_ExtractOrders" targetRef="Gateway_Join"/>
    <bpmn:sequenceFlow id="Flow_7" sourceRef="Task_ExtractProducts" targetRef="Gateway_Join"/>
    <bpmn:sequenceFlow id="Flow_8" sourceRef="Gateway_Join" targetRef="Task_ValidateSchema"/>
    <bpmn:sequenceFlow id="Flow_9" sourceRef="Task_ValidateSchema" targetRef="Task_LoadRaw"/>
    <bpmn:sequenceFlow id="Flow_10" sourceRef="Task_LoadRaw" targetRef="EndEvent_1"/>
  </bpmn:process>

  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="js-process-raw-ingestion">
      <bpmndi:BPMNShape id="StartEvent_1_di" bpmnElement="StartEvent_1">
        <dc:Bounds x="152" y="192" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_Split_di" bpmnElement="Gateway_Split">
        <dc:Bounds x="245" y="185" width="50" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_ExtractCustomers_di" bpmnElement="Task_ExtractCustomers">
        <dc:Bounds x="350" y="80" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_ExtractOrders_di" bpmnElement="Task_ExtractOrders">
        <dc:Bounds x="350" y="170" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_ExtractProducts_di" bpmnElement="Task_ExtractProducts">
        <dc:Bounds x="350" y="260" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_Join_di" bpmnElement="Gateway_Join">
        <dc:Bounds x="505" y="185" width="50" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_ValidateSchema_di" bpmnElement="Task_ValidateSchema">
        <dc:Bounds x="610" y="170" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_LoadRaw_di" bpmnElement="Task_LoadRaw">
        <dc:Bounds x="770" y="170" width="100" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_1_di" bpmnElement="EndEvent_1">
        <dc:Bounds x="932" y="192" width="36" height="36"/>
      </bpmndi:BPMNShape>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
